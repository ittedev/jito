var u=Symbol.for("Jito Reactive"),z=Symbol.for("Jito Lock"),g=Symbol.for("Jito Recursive"),j=Symbol.for("Jito Array");function R(e){return typeof e=="object"&&e!==null&&(Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e))&&!Object.isFrozen(e)&&!e[z]}function be(e,t){return I(e,[],!1,t),e}function I(e,t,r,n){if(R(e)&&!t.includes(e)){t.push(e),r&&te(e),n&&u in e&&e[u][g][1].add(n);for(let a in e)I(e[a],t,r,n);t.pop()}return e}function D(e,t,r){return R(e)&&(t===void 0?G(e,[],!0):typeof r=="function"?(Array.isArray(t)?t.forEach(n=>Me(e,n,r)):Me(e,t,r),Ee(e)):G(e,[],!0,t)),e}function Ee(e){if(u in e){let t=e;if(!t[u][g][1].size){let r=!1;for(let n in t)t[u][n][1].size>1&&(r=!0);if(!r){for(let n in t[u])Object.defineProperty(t,n,{enumerable:!0,configurable:!0,writable:!0,value:t[u][n][0]}),delete t[u][n];Array.isArray(t)&&(delete t.unshift,delete t.push,delete t.splice,delete t.pop,delete t.shift,delete t.sort,delete t.reverse,delete t.copyWithin),delete t[u]}}}}function Me(e,t,r){t in e[u]&&e[u][t][1].forEach(n=>{n[1]===r&&e[u][t][1].delete(n)})}function J(e,t){return G(e,[],!1,t)}function G(e,t,r,n){if(R(e)&&!t.includes(e)){if(t.push(e),e[u]){let a=e;if(n)a[u][g][1].delete(n);else{a[u][g][1].clear();for(let i in a)a[u][i][1].clear()}}for(let a in e)G(e[a],t,r,n);r&&Ee(e),t.pop()}return e}function A(e,t,r,n){return R(e)&&(t===void 0?I(e,[],!0):typeof r=="function"?(I(e,[],!0),Array.isArray(t)?t.forEach(a=>S(e,a,["spy",r])):S(e,t,["spy",r]),n&&r(e[t],e[t])):(I(e,[],!0,t),r&&t())),e}function te(e){if(!(u in e)){let t=new Set,r=()=>{t.forEach(a=>a())},n=["bio",r];if(e[u]={[g]:[n,t]},Array.isArray(e)){let a=e[u][j]=e.slice(),i=o=>(r(),o),s=o=>{let l=e[u][j].length;if(e.length<l)for(let c=e.length;c<l;c++)S(e,c);return e.length=l,i(o)};Object.defineProperties(e,{unshift:{get(){return(...o)=>s(Array.prototype.unshift.call(a,...o.map(l=>q(e,l))))}},push:{get(){return(...o)=>s(Array.prototype.push.call(a,...o.map(l=>q(e,l))))}},splice:{get(){return(o,l,...c)=>s(l===void 0?Array.prototype.splice.call(a,o,a.length-o):Array.prototype.splice.apply(a,[o,l,...c.map(x=>q(e,x))]))}},pop:{get(){return()=>s(Array.prototype.pop.call(a))}},shift:{get(){return()=>s(Array.prototype.shift.call(a))}},sort:{get(){return o=>i(o===void 0?Array.prototype.sort.call(a):Array.prototype.sort.call(a,o))}},reverse:{get(){return()=>i(Array.prototype.reverse.call(a))}},copyWithin:{get(){return(o,l,c)=>i(Array.prototype.copyWithin.call(a,o,l!==void 0?l:0,c!==void 0?c:a.length))}}})}}if(u in e){let t=e[u][g][0];for(let r in e)S(e,r,t)}}function S(e,t,r){let n=Object.getOwnPropertyDescriptor(e,t);if(!Array.isArray(e)||typeof t!="number"&&isNaN(t)){if(!(t in e[u])&&(!n||!n.set&&!n.get)&&(e[u][t]=[e[t],new Set],Object.defineProperty(e,t,{get(){return this[u][t][0]},set(a){ft(this,this[u][t],a)}})),t in e[u]&&r){for(let a of e[u][t][1])if(a[1]===r[1])return;e[u][t][1].add(r)}}else(!n||"value"in n)&&t in e[u][j]&&Object.defineProperty(e,t,{get(){return this[u][j][t]},set(a){let i=this[u][j][t];i!==a&&(q(this,a),He(this,i),this[u][j][t]=a,e[u][g][0][1]())},configurable:!0,enumerable:!0})}function q(e,t){return A(t),e[u][g][1].forEach(r=>A(t,r)),t}function He(e,t){return e[u][g][1].forEach(r=>J(t,r)),t}function ft(e,t,r){let n=t[0];t[0]=r,n!==r&&(q(e,r),He(e,n),t[1].forEach(a=>{switch(a[0]){case"bio":a[1]();break;case"bom":t[1].delete(a);case"spy":a[1](r,n);break}}))}async function xe(e,...t){if(R(e)){te(e);let r=Array.isArray(t[0])?t.reduce((a,i)=>(a.push(...i),a),[]):t,n=await Promise.all(r.map(a=>e[a]===void 0?new Promise(i=>{S(e,a,["bom",i])}):e[a]));return r.reduce((a,i,s)=>(a[i]=n[s],a),{})}return{}}function re(e,t,r){if(typeof e=="object"&&e!==null){if(!(t in e)&&u in e){let n=e;n[t]=void 0,S(n,t,n[u][g][0])}e[t]=r}return r}function Re(e){return e[z]=!0,e}function dt(e){return delete e[z],e}var ne=Symbol.for("Jito Event Types");var Ie="destroy",Ne="patch";ne in window||Object.defineProperty(window,ne,{value:Object.seal({get destroy(){return Ie},set destroy(e){Ie=e},get patch(){return Ne},set patch(e){Ne=e}})});var L=window[ne];function _(e){let t={el:e};return $e(t),t}function ht(e){let t={tag:e.tagName.toLowerCase(),el:e};return gt(t),$e(t),t}function gt(e){if(e.el.hasAttributes()){let t={};e.el.getAttributeNames().forEach(r=>{if(r.startsWith("on"))return;let n=e.el.getAttribute(r);switch(r){case"class":case"part":return e[r]=n.split(/\s+/);case"style":case"is":return e[r]=n;default:return t[r]=n}}),Object.keys(t).length&&(e.attrs=t)}}function $e(e){if(e.el.hasChildNodes()){let t=e.el.childNodes;e.children=[];for(let r=0;r<t.length;r++)switch(t[r].nodeType){case 1:if(t[r].tagName==="SCRIPT")break;e.children.push(ht(t[r]));break;case 3:e.children.push(t[r].data);break}}}function V(e,t=!0){if(!(e.invalid&&e.invalid.children)&&e.el instanceof Node){e.children&&e.children.forEach(n=>typeof n=="object"&&V(n,t));let r=e.el;for(;r.firstChild;)r.removeChild(r.firstChild)}t&&e.tag&&e.el.dispatchEvent(new CustomEvent(L.destroy,{bubbles:!1})),e.invalid&&e.invalid.on||le(e,{}),!(e.invalid&&e.invalid.attrs)&&e.el instanceof Element&&(ae(e,{}),ie(e,{}),se(e,{}),oe(e,{}),pe(e,{}))}function K(e,t,r=!0){return Ce(e,t,r),r&&e.el.dispatchEvent(new CustomEvent(L.patch,{bubbles:!0,composed:!0})),e}function ve(e,t,r){return(!e||e.tag!==t.tag||e.is!==t.is||t.new)&&(e=t.is?{tag:t.tag,is:t.is,el:document.createElement(t.tag,{is:t.is})}:{tag:t.tag,el:document.createElement(t.tag)}),ae(e,t),ie(e,t),se(e,t),pe(e,t),oe(e,t),le(e,t),Ce(e,t,r),"key"in t?e.key=t.key:delete e.key,e}function ze(e,t,r){if((!e||e.el!==t.el)&&(e={el:t.el},"override"in t&&(e.override=t.override),"invalid"in t)){e.invalid={};for(let n in t.invalid)e.invalid[n]=t.invalid[n]}return!(e.invalid&&e.invalid.attrs)&&e.el instanceof Element&&(ae(e,t),ie(e,t),se(e,t),pe(e,t),oe(e,t)),e.invalid&&e.invalid.on||le(e,t),!(e.invalid&&e.invalid.children)&&e.el instanceof Node&&Ce(e,t,r),e}function ae(e,t){let r=(e.class||[]).join(" "),n=(t.class||[]).join(" ");r!==n&&(e.el.className=n),n.length?e.class=(t.class||[]).slice():delete e.class}function ie(e,t){let r=e.part||[],n=t.part||[],a=n.filter(s=>!r.includes(s));a.length&&e.el.part.add(...a);let i=r.filter(s=>!n.includes(s));i.length&&e.el.part.remove(...i),n.length?e.part=n.slice():delete e.part}function se(e,t){if(e.el instanceof HTMLElement){let r=e.style||"",n=t.style||"";r!=n&&(e.el.style.cssText=n,n!=""?e.style=n:delete e.style)}}function oe(e,t){let r=e.attrs||{},n=t.attrs||{},a=Object.keys(r),i=Object.keys(n);if(i.filter(s=>!a.includes(s)||r[s]!==n[s]).forEach(s=>e.el.setAttribute(s,n[s])),a.filter(s=>!i.includes(s)).forEach(s=>e.el.removeAttribute(s)),i.length){e.attrs={};for(let s in n)e.attrs[s]=n[s]}else delete e.attrs}function le(e,t){let r=e.on||{},n=t.on||{},a=Object.keys(r),i=Object.keys(n);i.filter(s=>!a.includes(s)).forEach(s=>{n[s].forEach(o=>{e.el.addEventListener(s,o)})}),a.filter(s=>!i.includes(s)).forEach(s=>{r[s].forEach(o=>{e.el.removeEventListener(s,o)})}),i.filter(s=>a.includes(s)).forEach(s=>{let o=n[s],l=r[s];o.filter(c=>!l.includes(c)).forEach(c=>e.el.addEventListener(s,c)),l.filter(c=>!o.includes(c)).forEach(c=>e.el.removeEventListener(s,c))}),i.length?e.on=i.reduce((s,o)=>(s[o]=[...n[o]],s),{}):delete e.on}function pe(e,t){if(Object.prototype.isPrototypeOf.call(HTMLInputElement.prototype,e.el)){let r=e.el;(e.attrs&&e.attrs.value)!==(t.attrs&&t.attrs.value)&&r.value!==(t.attrs&&t.attrs.value)&&(t.attrs&&"value"in t.attrs?r.value!==(t.attrs&&t.attrs.value).toString()&&(r.value=t.attrs.value):e.el.value!==""&&(e.el.value="")),!r.checked&&t.attrs&&"checked"in t.attrs?r.checked=!0:r.checked&&!(t.attrs&&"checked"in t.attrs)&&(r.checked=!1)}if(Object.prototype.isPrototypeOf.call(HTMLOptionElement.prototype,e.el)){let r=e.el;!r.selected&&t.attrs&&"selected"in t.attrs?r.selected=!0:r.selected&&!(t.attrs&&"selected"in t.attrs)&&(r.selected=!1)}}var we=class{constructor(){this.stock=new Map}has(t){let r=this.stock.get(t);return r&&r.length}push(t,r){this.stock.has(t)?this.stock.get(t).push(r):this.stock.set(t,[r])}shift(t){return this.stock.get(t).shift()}};function Ce(e,t,r){let n=e.children||[],a=t.children||[];if(n.length===0&&a.length===0||n.length===0&&e.el.hasChildNodes())return;let i=n.length===0&&a.length>1?new DocumentFragment:e.el,s=new we,o=0,l=i.firstChild,c=a.filter(f=>typeof f=="number").reverse(),x=c.pop(),h=f=>{let m=ve(null,f,r);return i.insertBefore(m.el,l||null),m},b=f=>{let m=ve(n[o],f,r);return m!==n[o]&&(V(n[o],r),i.replaceChild(m.el,n[o].el)),l=m.el.nextSibling,o++,m},$=(f=!1)=>{let m=n[o];if(typeof m!="number"){if(typeof m=="object"){if(l!==m.el){V(m,r),o++;return}f&&"key"in m?s.push(m.key,m):V(m,r)}if(typeof m=="string"||typeof m=="object"&&!m.override){let ee=l;l=ee.nextSibling,i.removeChild(ee)}}o++},Fe=a.map(f=>{switch(typeof f){case"string":return typeof n[o]=="string"?(l.data!==f&&(l.data=f),l=l.nextSibling,o++):i.insertBefore(document.createTextNode(f),l||null),f;case"object":{if("el"in f)if(typeof n[o]=="object"&&f.el===n[o].el){let m=ze(n[o],f,r);return!m.override&&m.el===l&&m.el instanceof Element&&m.el.getRootNode()===l.getRootNode()&&(l=l.nextSibling),o++,m}else{let m=ze(null,f,r);return!m.override&&m.el instanceof Element&&m.el.parentNode===null&&i.insertBefore(m.el,l||null),m}if("key"in f)if(s.has(f.key)){let m=ve(s.shift(f.key),f,r);return i.insertBefore(m.el,l||null),m}else{for(;o<n.length&&n[o]!==x;){if(typeof n[o]=="object"&&f.key===n[o].key)return b(f);$(!0)}return h(f)}else return typeof n[o]=="object"&&!("el"in f)&&!("key"in n[o])?b(f):h(f)}case"number":{for(;o<n.length&&n[o]!==f;)$();return o++,x=c.pop(),s.stock.forEach(m=>m.forEach(ee=>V(ee,r))),s.stock.clear(),f}}});for(;o<n.length;)$();Fe.length?e.children=Fe:delete e.children,n.length===0&&a.length>1&&e.el.append(i)}function T(e,t){return F(e,t)[0]}function F(e,t,r=e.length-1){for(let n=r;n>=0;n--)if(t in e[n])return[e[n][t],n];return[void 0,-1]}var U=class{constructor(t,r,n,a,i){this._key=t;this._value=r;this._index=n;this._entries=a;this._stack=i}get key(){return this._key}get value(){return this._value}get index(){return this._index}get size(){return this._entries.length}get isFirst(){return this._index===0}get isLast(){return this._index===this._entries.length-1}get parent(){return T(this._stack,"loop")}toJSON(){return{key:this._key,value:this._value,_index:this._index,size:this._entries.length,isFirst:this._index===0,isLast:this._index===this._entries.length-1}}};var ce=Symbol.for("Jito Ref");function M(e){return typeof e=="object"&&e!==null&&typeof e.type=="string"}function W(e){return typeof e=="object"&&e!==null&&e[ce]===!0}function Ge(e){return typeof e=="object"&&e!==null&&e.template&&e.restack}function ue(e){return"tag"in e}var O=class{constructor(t,r,n=0,a=null){this.text=t;this.field=r;this.index=n;this.token=a}_next(t){let r=["",""];for(this.index=t;this.index<this.text.length;this.index++){let n=De(this.field,r[1]+this.text[this.index]);if(n==="other")return r;r[0]=n,r[1]=r[1]+this.text[this.index]}return r}skip(t=[]){t.unshift("other");let r="";if(!this.token)for(let n=this.index;n<this.text.length;n++)if(t.includes(De(this.field,this.text[n])))r+=this.text[n];else if(this.token=this._next(n),this.token&&this.token[0]==="partial")r+=this.token[1],n=this.index-1,this.token=null;else return r;return r}nextIs(t){return this.skip(),this.token?t?this.token[0]===t:this.token[0]:!1}pop(){this.skip();let t=this.token;return this.token=null,t||null}expand(t,r){let n=this.field;this.field=t,r(),this.token&&(this.index-=this.token[1].length,this.token=null),this.field=n}must(t){let r=this.pop();if(!r||r[0]!==t)throw Error(t+" is required.");return r}};function De(e,t){switch(e){case"html":switch(t){case">":case"<!--":case"/":case"{{":case"{|":return t;case"&":case"&a":case"&am":case"&amp":case"&l":case"&lt":case"&g":case"&gt":case"&q":case"&qu":case"&quo":case"&quot":case"<":case"</":case"<!":case"<!-":case"{":return"partial";case"&amp;":case"&lt;":case"&gt;":case"&quot;":return"entity"}switch(!0){case/^\/\/.*$/.test(t):return"//";case/^<[_a-zA-Z][_a-zA-Z0-9]*[\.\-]$/.test(t):return"partial";case/^<[_a-zA-Z][_a-zA-Z0-9]*([\.\-][_a-zA-Z][_a-zA-Z0-9]*)*$/.test(t):return"start";case/^<\/[_a-zA-Z][_a-zA-Z0-9]*[\.\-]$/.test(t):return"partial";case/^<\/[_a-zA-Z][_a-zA-Z0-9]*([\.\-][_a-zA-Z][_a-zA-Z0-9]*)*$/.test(t):return"end"}break;case"attr":switch(t){case"@try":case"@catch":case"@if":case"@else":case"@for":case"@each":case"@bind":case"@to":case"@chunk":return"@";case"=":case":=":case"&=":case"*=":return"assign";case">":case"/":case"'":case'"':return t;case":":case"&":case"*":return"partial"}switch(!0){case/^on[_\$\-a-zA-Z0-9]+$/.test(t):return"on";case/^[_\$\-@a-zA-Z0-9]+$/.test(t):return"name"}break;case"comment":switch(t){case"-->":return t;case"-":case"--":return"partial"}break;case"plane":switch(t){case"<":case"</":case"</s":case"</sc":case"</scr":case"</scri":case"</scrip":case"<\/script":return"partial";case"<\/script>":return"end"}break;case"script":switch(t){case"+":case"-":return"multi";case"void":case"typeof":case"~":case"!":return"unary";case"*":case"%":case"**":case"in":case"instanceof":case"<":case">":case"<=":case">=":case"==":case"!=":case"===":case"!==":case"<<":case">>":case">>>":case"&":case"|":case"^":case"&&":case"||":case"??":return"binary";case"=":case"*=":case"**=":case"/=":case"%=":case"+=":case"-=":case"<<=":case">>=":case">>>=":case"&=":case"^=":case"|=":case"&&=":case"||=":case"??=":return"assign";case"++":case"--":return"crement";case"false":case"true":return"boolean";case"/":case"null":case"undefined":case".":case"?.":case"[":case"]":case"{":case"}":case"(":case")":case"...":case"?":case":":case",":case"'":case'"':case"`":case"|}":return t}switch(!0){case/^\/\/.*$/.test(t):return"//";case/^[_\$a-zA-Z][_\$a-zA-Z0-9]*$/.test(t):return"word";case/^\d+\.?\d*$|^\.?\d+$/.test(t):return"number"}break;case"template":switch(t){case"$":return"partial";case"${":return t;case"}":return t;case"`":return"`";case"\r":case`
`:case`\r
`:return"other"}case"single":case"double":switch(t){case"\\":return"partial";case"\r":case`
`:case`\r
`:return"return";case`\\\r
`:return"escape";case"'":if(e==="single")return t;break;case'"':if(e==="double")return t;break}switch(!0){case/^\\u[0-9a-fA-F]{0,3}$/.test(t):case/^\\x[0-9a-fA-F]{0,1}$/.test(t):case/^\\u\{(0?[0-9a-fA-F]{0,5}|10[0-9a-fA-F]{0,4})$/.test(t):return"partial";case/^\\.$/.test(t):case/^\\u[0-9a-fA-F]{4}$/.test(t):case/^\\u\{(0?[0-9a-fA-F]{1,5}|10[0-9a-fA-F]{1,4})\}$/.test(t):case/^\\x[0-9a-fA-F]{2}$/.test(t):return"escape"}break;case"text":switch(t){case"{":case"}":case"|":return"partial";case"{{":case"}}":case"{|":case"|}":return t}break;case"regex":switch(t){case"/":return t;case"\\":return"partial";case"\\/":return"string"}switch(!0){case/^\\.$/.test(t):return"escape";case/^[^gimsuy]$/.test(t):return"string";case/^[gimsuy]+$/.test(t):return"flags"}break}return"other"}function me(e){switch(e){case"\\n":return`
`;case"\\r":return"\r";case"\\v":return"\v";case"\\t":return"	";case"\\b":return"\b";case"\\f":return"\f"}switch(!0){case/^\\u[0-9a-fA-F]{4}$/.test(e):case/^\\x[0-9a-fA-F]{2}$/.test(e):return String.fromCodePoint(parseInt(e.slice(2),16));case/^\\u\{(0?[0-9a-fA-F]{1,5}|10[0-9a-fA-F]{1,4})\}$/.test(e):return String.fromCodePoint(parseInt(e.slice(3,-1),16))}return e.slice(1)}function d(e){let t=typeof e=="string"?new O(e,"script"):e;return Tt(t)}function Tt(e){let t=yt(e);if(e.nextIs("assign")){if(t.type!=="get")throw Error("The left operand is not variable");let r=e.pop()[1],n=d(e);return{type:"assign",operator:r,left:t.value,right:n}}else return t}function yt(e){let t=Je(e);for(;e.nextIs("?");){e.pop();let r=d(e);e.must(":");let n=Je(e);t={type:"if",condition:t,truthy:r,falsy:n}}return t}function Je(e){let t=new Array;for(t.push(fe(e));e.nextIs("multi")||e.nextIs("binary")||e.nextIs("/");)t.push(e.pop()[1]),t.push(fe(e));for(;t.length>1;)for(let r=0;r+1<t.length;r+=2)if(r+3>=t.length||qe(t[r+1])>qe(t[r+3])){let n={type:"binary",operator:t[r+1],left:t[r],right:t[r+2]};t.splice(r,3,n)}return typeof t[0]=="string"?{type:"variable",name:t[0]}:t[0]}function qe(e){switch(e){default:return 0;case"||":case"??":return 4;case"&&":return 5;case"|":return 6;case"^":return 7;case"&":return 8;case"==":case"!=":case"===":case"!==":return 9;case"in":case"instanceof":case"<":case">":case"<=":case">=":return 10;case"<<":case">>":case">>>":return 11;case"+":case"-":return 12;case"*":case"/":case"%":return 13;case"**":return 14}}function fe(e){switch(e.nextIs()){case"multi":case"unary":return{type:"unary",operator:e.pop()[1],operand:fe(e)};case"crement":return{type:"assign",operator:e.pop()[1].charAt(0)+"=",left:fe(e).value,right:{type:"literal",value:1}};default:return kt(e)}}function kt(e){let t=bt(e);return e.nextIs("crement")?{type:"assign",operator:e.pop()[1].charAt(0)+"=",left:t.value,right:{type:"literal",value:1},prevalue:!0}:t}function bt(e){let t=Et(e);for(;;){switch(e.nextIs()){case"(":{e.pop();let r=[];for(;!e.nextIs(")")&&(r.push(d(e)),e.nextIs(","));)e.pop();e.must(")"),t={type:"function",name:t,params:r};continue}case".":{e.pop();let r=e.must("word");t={type:"get",value:{type:"hash",object:t,key:{type:"literal",value:r[1]}}};continue}case"[":{e.pop();let r=d(e);e.must("]"),t={type:"get",value:{type:"hash",object:t,key:r}};continue}}break}return t}function Et(e){let t=e.pop();switch(t[0]){case"word":return{type:"get",value:{type:"variable",name:t[1]}};case"number":return{type:"literal",value:Number(t[1])};case"boolean":return{type:"literal",value:t[1]==="true"};case"undefined":return{type:"literal",value:void 0};case"null":return{type:"literal",value:null};case'"':return Z(e,"double",t[0]);case"'":return Z(e,"single",t[0]);case"`":return Z(e,"template",t[0]);case"/":return xt(e);case"(":{let r=d(e);return e.must(")"),r}case"[":{let r=[];for(;!e.nextIs("]");)if(r.push(d(e)),e.nextIs(","))e.pop();else if(e.nextIs("]")){e.pop();break}else throw Error("']' is required");return{type:"array",values:r}}case"{":{let r=[];for(;!e.nextIs("}");){let n=Array(2),a=e.pop();if(a[0]==="word"?n[0]={type:"literal",value:a[1]}:a[0]==='"'?n[0]=Z(e,"double",a[0]):a[0]==="'"?n[0]=Z(e,"single",a[0]):a[0]==="["&&(n[0]=d(e),e.must("]")),a[0]==="word"&&(e.nextIs(",")||e.nextIs("}"))?n[1]={type:"get",value:{type:"variable",name:a[1]}}:(e.must(":"),n[1]=d(e)),r.push(n),e.nextIs(","))e.pop();else{if(e.nextIs("}"))break;throw Error("'}' is required")}}return e.pop(),{type:"object",entries:r}}default:throw new Error(t[0]+" is invalid")}}function Z(e,t,r){let n=[""],a=0;return e.expand(t,()=>{e:for(;;){n[a]+=e.skip();let i=e.pop();switch(i[0]){case r:break e;case"return":throw Error("Newline cannot be used");case"escape":n[a]+=me(i[1]);continue;case"${":e.expand("script",()=>{n.push(d(e))}),e.must("}"),n.push(e.skip()),a+=2}}}),a===0?{type:"literal",value:n[0]}:{type:"join",values:n.filter(i=>i!==""),separator:""}}function xt(e){let t={type:"regex",value:""};return e.expand("regex",()=>{for(;;){t.value+=e.skip();let r=e.pop();if(r[0]==="/")break;t.value+=r[1]}e.nextIs("flags")&&(t.flags=e.pop()[1])}),t}function N(e){switch(e){case"html":case"base":case"head":case"link":case"meta":case"style":case"title":case"body":case"address":case"article":case"aside":case"footer":case"header":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"main":case"nav":case"section":case"blockquote":case"dd":case"div":case"dl":case"dt":case"figcaption":case"figure":case"hr":case"li":case"ol":case"p":case"pre":case"ul":case"a":case"abbr":case"b":case"bdi":case"bdo":case"br":case"cite":case"code":case"data":case"dfn":case"em":case"i":case"kbd":case"mark":case"q":case"rp":case"rt":case"ruby":case"s":case"samp":case"small":case"span":case"strong":case"sub":case"sup":case"time":case"u":case"var":case"wbr":case"area":case"audio":case"img":case"map":case"track":case"video":case"embed":case"iframe":case"object":case"param":case"picture":case"portal":case"source":case"svg":case"math":case"canvas":case"noscript":case"script":case"del":case"ins":case"caption":case"col":case"colgroup":case"table":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":case"button":case"datalist":case"fieldset":case"form":case"input":case"label":case"legend":case"meter":case"optgroup":case"option":case"output":case"progress":case"select":case"textarea":case"details":case"dialog":case"menu":case"summary":case"slot":case"template":return!0}return!1}function de(e){switch(e){case"br":case"hr":case"img":case"input":case"meta":case"area":case"base":case"col":case"embed":case"keygen":case"link":case"param":case"source":case"let":return!0}return!1}function he(e){let t=typeof e=="string"?new O(e,"html"):e,r={text:P(t)};for(;t.nextIs("<!--");)t.pop(),t.expand("comment",()=>t.must("-->")),r.text+=P(t);return t.nextIs("start")&&(r.next=Rt(t)),r.text?r:r.next?r.next:void 0}function P(e){let t=e.skip([">","/","}}","|}"]);if(e.nextIs("entity"))switch(e.pop()[1]){case"&amp;":return t+"&"+P(e);case"&lt;":return t+"<"+P(e);case"&gt;":return t+">"+P(e);case"&quot;":return t+'"'+P(e)}return e.nextIs("{{")?(t+=e.pop()[1],e.expand("text",()=>{t+=e.skip(["{{"]),t+=e.must("}}")[1]}),t+P(e)):e.nextIs("{|")?(t+=e.pop()[1],e.expand("text",()=>{t+=e.skip(["{|"]),t+=e.must("|}")[1]}),t+P(e)):t}function Rt(e){let t={tag:e.pop()[1].slice(1)},r=vt(e);if(r.length&&(t.attrs=r),e.nextIs("/"))e.pop(),e.must(">");else if(de(t.tag))e.must(">");else{if(e.must(">"),t.tag!=="script"){let a=he(e);a&&(t.child=a)}else e.expand("plane",()=>e.nextIs("end"));if(e.must("end")[1].slice(2)!==t.tag)throw Error(`end tag </${t.tag}> is required.`);e.must(">")}let n=he(e);return n&&(t.next=n),t.tag==="script"?t.next?t.next:void 0:t}function vt(e){let t=[];return e.expand("attr",()=>{for(e.skip();e.nextIs()&&!e.nextIs(">");){let r=new Array(3);if(e.nextIs("name"))if(r[0]=e.pop()[1],e.nextIs("assign"))r[1]=e.must("assign")[1];else if(e.nextIs("name")||e.nextIs(">")||e.nextIs("/"))r[1]="=",r[2]=r[0];else throw Error("assign is required.");else{if(e.nextIs("on"))r[0]=e.pop()[1],r[1]="on";else if(e.nextIs("@"))r[0]=e.pop()[1],r[1]="@";else break;if(r[0]==="@try"||r[0]==="@catch"||r[0]==="@else")r[2]=r[0];else if(e.must("assign")[1]!=="=")throw Error("= is required.")}r[2]===void 0&&(e.nextIs('"')?r[2]=Ke(e,"double",e.pop()[0]):e.nextIs("'")&&(r[2]=Ke(e,"single",e.pop()[0]))),t.push(r),e.skip()}}),t}function Ke(e,t,r){let n="";return e.expand(t,()=>{e:for(;;){n+=e.skip();let a=e.pop();switch(a[0]){case r:break e;case"return":throw Error("Newline cannot be used");case"escape":n+=me(a[1]);continue}}}),n}function E(e){let t=he(e),r=t?Se(t):[];return r.length?{type:"tree",children:r}:{type:"tree"}}var Ae=class{constructor(t){this.node=t}isSkippable(t){for(let r=this.node;r;r=r.next){if(ue(r))return Q(r,t);if(!/^\s*$/.test(r.text))return!1}return!1}skip(){for(;;){if(ue(this.node))return this;this.node=this.node.next}}pop(){let t=this.node;return this.node=this.node&&this.node.next,t}};function Se(e){return Qe(new Ae(e))}function Qe(e){let t=[];for(;e.node;){let r=wt(e);r!==void 0&&t.push(r)}return t}function wt(e){if(!e.node)e.pop();else return ue(e.node)?Ye(e):et(e.pop().text,!0)}function Xe(e){return Ye(e)}function Ye(e){let t=e.node;if(Q(t,"@try")){let r=Ue(e),n={type:"try",value:r};return e.isSkippable("@catch")&&(n.failure=Xe(e.skip())),n}else return Ue(e)}function Ue(e){let t=e.node;if(Q(t,"@for")){let r=B(t,"@each")||void 0,n=d(B(t,"@for"));return{type:"for",each:r,array:n,value:We(e)}}else return We(e)}function We(e){let t=e.node;if(Q(t,"@if")){let r=d(B(t,"@if")),n=Ze(e),a={type:"if",condition:r,truthy:n};return e.isSkippable("@else")&&(a.falsy=Xe(e.skip())),a}else return Ze(e)}function Ze(e){let t=e.node;if(Q(t,"@bind")){let r=B(t,"@bind"),n={type:"bind",name:r},a=B(t,"@to");return a&&(n.to=d(a)),n.value=Be(e),n}else return Be(e)}function Be(e){if(e.node.tag==="let"){let r={type:"group"};e.pop();let n=Qe(e);return n.length&&(r.children=n),r}else return Ct(e.pop())}function Ct(e){if(e.tag==="group"){let t={type:"group"};if(e.attrs&&e.attrs.forEach(([r,,n])=>{r.match(/^@(if|else|for|each|bind|to)$/)||r.match(/^@.*$/)&&(t.attrs||(t.attrs={}),t.attrs[r]=n)}),e.child){let r=Se(e.child);r.length&&(t.children=r)}return t}else return At(e)}function At(e){let t={type:"element",tag:e.tag};{let r=[];e.attrs&&e.attrs.forEach(([n,a,i])=>{switch(a){case"=":{let s=et(i);if(s){switch(n){case"is":{n in t||(t.is=s);return}case"class":case"part":{let o=typeof s=="string"||s.type!=="join"?[s]:s.values;t[n]||(t[n]=[]),o.forEach(l=>{typeof l=="string"?l&&t[n].push(l.split(/\s+/).filter(c=>c)):M(l)&&t[n].push({type:"split",value:l,separator:" "})});return}case"style":return r.push(s)}if(t.attrs||(t.attrs={}),!(n in t.attrs))return t.attrs[n]=s}return}case":=":{switch(n){case"is":return t.is=d(i);case"class":case"part":return t[n]||(t[n]=[]),t[n].push({type:"flags",value:d(i)});case"style":return r.push(d(i))}return t.attrs||(t.attrs={}),t.attrs[n]=d(i)}case"*=":{let s=d(i);return M(s)&&s.type==="get"&&(s=s.value),t.attrs||(t.attrs={}),t.attrs[n]=s}case"on":{let s=n.slice(2),o={type:"handler",value:d(i)};return t.on||(t.on={}),t.on[s]||(t.on[s]=[]),t.on[s].push(o)}case"@":if(n==="@chunk")return t.chunks||(t.chunks=[]),t.chunks.push(d(i))}}),r.length&&(r.length===1&&typeof r[0]=="string"?t.style=r[0]:t.style={type:"join",values:r.filter(n=>n!==""),separator:";"}),e.attrs&&e.attrs.forEach(([n,a,i])=>{a==="&="&&(t.bools||(t.bools={}),t.bools[n]=d(i),t.attrs&&(delete t.attrs[n],Object.keys(t.attrs).length||delete t.attrs))})}if(e.child){let r=Se(e.child);r.length&&(t.children=r)}return(!N(t.tag)||t.is)&&(t.type="custom"),t}function Q(e,t){return e.attrs&&e.attrs.some(r=>r[0]===t)}function B(e,t){let r=e.attrs&&e.attrs.find(n=>n[0]===t);return r?r[2]:""}function et(e,t=!1){let r=new O(e,"text"),n=[];for(n.push(r.skip());r.nextIs();)if(r.nextIs("{{")||r.nextIs("{|")){let i=r.pop();r.expand("script",()=>{let s=d(r);n.push(t?{type:"draw",value:s}:s)}),i[0]==="{{"?r.must("}}"):r.must("|}"),n.push(r.skip())}else r.pop();let a=n.filter(i=>i);return a.length===0?"":a.length===1&&(typeof a[0]=="string"||!t)?a[0]:t?{type:"flat",values:a}:{type:"join",values:a}}var tt={match(e,t,r){if(e.type==="custom"){let n=e;if(!N(n.tag)){let a=n.tag.split("."),i=a.slice(1).reduce((s,o)=>s[o],T(t,a[0]));return n.tag==="window"||i instanceof EventTarget}}return!1},exec(e,t,r){let n=e;if(e.tag==="window"){let o={el:window,override:!0,invalid:{attrs:!0,children:!0}};return w(n,t,r,o),o}let a=n.tag.split("."),i=a.slice(1).reduce((o,l)=>o[l],T(t,a[0])),s={el:i};return w(n,t,r,s),i instanceof Element&&n.attrs&&"@override"in n.attrs&&(s.override=!0),(i instanceof Element||i instanceof DocumentFragment||i instanceof ShadowRoot)&&n.children&&n.children.length?s.children=H(n,t,r):s.invalid={children:!0},s}},rt={match(e,t,r){if(e.type==="custom"){let a=e.tag.split("."),i=a.slice(1).reduce((s,o)=>s[o],T(t,a[0]));if(Ge(i))return!0}return!1},exec(e,t,r){let n=e,a=n.tag.split("."),i=a.slice(1).reduce((h,b)=>h[b],T(t,a[0])),s={tag:n.tag};ge(n,t,r,s);let o={tag:n.tag};w(n,t,r,o);let l={};if(o.attrs)for(let h in o.attrs){let b=o.attrs[h];W(b)?Object.defineProperties(l,{[h]:{get(){return b.record[b.key]},set($){b.record[b.key]=$}}}):l[h]=b}if(["class","part","is","style"].forEach(h=>{h in o&&(l[h]=o[h])}),o.on)for(let h in o.on)l["on"+h]=o.on[h];return p(i.template,i.restack([...t,{attrs:l},s.attrs||{},l]),r).children}};function ge(e,t,r,n){let a=[],i=[],s=(e.children||[]).map(o=>{if(typeof o!="string"){let l=o;if(l.attrs){if(l.attrs["@as"])return i.push([l.attrs["@as"],l]),[];if(l.attrs.slot)return[p(o,t,r)]}}return a.push(o),[]}).reduce((o,l)=>(o.push(...l),o),[]);a.length&&i.push(["content",{type:"group",children:a}]),i.length&&(n.attrs||(n.attrs={}),i.forEach(([o,l])=>{n.attrs[o]={type:"evaluation",value:l,stack:t}})),s.length&&(n.children=s)}var Le=new Array,p=function(e,t=[],r={}){let n=e;switch(n.type){case"literal":return n.value;case"array":return n.values.map(a=>p(a,t,r));case"object":return n.entries.map(a=>a.map(i=>p(i,t))).reduce((a,i)=>(a[i[0]]=i[1],a),{});case"variable":{let[,a]=F(t,n.name);return a>=0?{record:t[a],key:n.name,[ce]:!0}:void 0}case"unary":return St(n.operator,p(n.operand,t,r));case"binary":{let a=p(n.left,t,r);return nt(n.operator,a)?at(n.operator,a,p(n.right,t,r)):a}case"assign":{let a=p(n.left,t,r);if(!a)throw Error(n.left?n.left.name:"key is not defined");let{record:i,key:s}=a;if(typeof i=="function"||i===Object)throw Error("Cannot assign to this object");if(s==="__proto__")throw Error("Cannot assign to "+s);let o=i[s];if(typeof o=="function")throw Error("Cannot assign to function");let l=p(n.right,t,r);if(n.operator.length>1){let c=n.operator.slice(0,-1);nt(c,o)&&(i[s]=at(c,o,l))}else i[s]=l;return n.prevalue?o:i[s]}case"function":{if(n.name.type==="get"&&n.name.value.type==="hash"){let a=p(n.name.value,t,r);if(!a)throw Error(p(n.name.value.key,t,r)+" is not defined");switch(a.key){case"__defineGetter__":case"__defineSetter__":throw Error("Cannot get "+a.key)}let i=a.record[a.key];if(typeof i=="function")return i.apply(a.record,n.params.map(s=>p(s,t,r)))}else{let a=p(n.name,t,r);if(typeof a=="function")return a(...n.params.map(i=>p(i,t,r)))}throw Error(n.name.toString()+" is not a function")}case"hash":return{record:p(n.object,t,r),key:p(n.key,t,r),[ce]:!0};case"get":{let a=p(n.value,t,r);if(a){if(a.key==="__proto__")throw Error("Cannot get "+a.key);return a.record[a.key]}else return a}case"regex":return new RegExp(n.value,n.flags);case"flat":{let a=n.values.map(i=>typeof i=="string"?[i]:_e(p(i,t,r))).reduce((i,s)=>(i.push(...s),i),[]).filter(i=>i!=="").reduce((i,s)=>{let o=i.length;return o&&typeof s=="string"&&typeof i[o-1]=="string"?i[o-1]+=s:i.push(s),i},[]);return a.length===1&&typeof a[0]=="string"?a[0]:a}case"draw":{let a=p(n.value,t,r);if(typeof a=="object")if(M(a))if(a.type==="tree"){a.type="group";let i=p(a,t,r);return a.type="tree",i}else return p(a,t,r);else return a!==null&&Object.getPrototypeOf(a)===Object.prototype?JSON.stringify(a):"";else return a==null?"":a+""}case"join":return n.values.reduce((a,i,s)=>{let o=a+(s&&n.separator||"");if(M(i)){let l=p(i,t,r);return o+(typeof l=="object"?"":l)}else return o+i},"");case"split":{let a=typeof n.value=="string"?n.value:p(n.value,t,r);return typeof a=="string"?a.split(n.separator):[]}case"flags":return Oe(p(n.value,t,r));case"try":try{return p(n.value,t,r)}catch{return n.failure?p(n.failure,t,r):null}case"if":return p(n.condition,t,r)?p(n.truthy,t,r):n.falsy?p(n.falsy,t,r):null;case"for":{let a=p(n.array,t,r),i;if(typeof a=="object"&&a!==null)if(Symbol.iterator in a)if("entries"in a)i=[...a.entries()];else{let s=0;i=[];for(let o of a)i.push([s++,o])}else i=Object.entries(a);else throw Error("@for syntax requires Object or Array");return i.map(([s,o],l)=>{let c=new U(s,o,l,i,t),x=_e(p(n.value,t.concat([n.each?{[n.each]:o,loop:c}:{loop:c}]),r)).filter(h=>typeof h!="number");return typeof c.value=="object"&&x.filter(h=>typeof h=="object").forEach(h=>h.key=c.value),x}).reduce((s,o)=>(s.push(...o),s),[])}case"bind":{let a=n.to?p(n.to,t,r):void 0;return p(n.value,t.concat([{[n.name]:a}]),r)}case"tree":{let a=H(n,t,r);return a.length?{children:a}:{}}case"custom":{let a=Le.find(s=>s.match(n,t,r)),i=a?a.exec(n,t,r):void 0;if(i)return i}case"element":{let a=H(n,t,r),s=a.length?{children:a}:{};return s.tag=n.tag,n.is&&(s.is=typeof n.is=="string"?n.is:p(n.is,t,r)),w(n,t,r,s),s}case"group":return H(n,t,r);case"handler":{r.handler||(r.handler=new WeakMap),r.handler.has(n)||r.handler.set(n,[]);let a=r.handler.get(n);for(let o of a)if(it(o[0],t))return o[0]=t,o[1];let i=[t],s=o=>p(n.value,[...i[0],{event:o}],r);return i.push(s),a.push(i),s}case"evaluation":return p(n.value,t,r);default:{let a=Le.find(i=>i.match(e,t,r));return a?a.exec(e,t,r):void 0}}};p.plugin=e=>{Le.unshift(e)};p.plugin(tt);p.plugin(rt);function H(e,t,r){let n=e.children||[],a=0;n.length&&(r.groups||(r.groups=[new WeakMap,0]),r.groups[0].has(e)?a=r.groups[0].get(e):(a=r.groups[1]=r.groups[1]+n.length,r.groups[0].set(e,a)));let i=n.map((s,o)=>{if(M(s)){let l=_e(p(s,t,r));switch(s.type){case"if":case"for":case"group":l.push(a-o)}return l}else return[s]}).reduce((s,o)=>(s.push(...o),s),[]);return typeof i[i.length-1]=="number"&&i.pop(),i}function w(e,t,r,n){if(e.chunks&&e.chunks.forEach(a=>{let i=p(a,t,r);if(typeof i=="object"&&i!==null&&Object.getPrototypeOf(i)===Object.prototype)for(let s in i){let o=i[s];if(s==="style")n.style=(n.style||"")+o;else if(s==="class")n.class=(n.class||[]).concat(Oe(o));else if(s==="part")n.part=(n.part||[]).concat(Oe(o));else if(s.startsWith("on")){let l=s.slice(2);n.on||(n.on={}),n.on[l]=(n.on[l]||[]).concat(Array.of(o)?o:[o])}else n.attrs||(n.attrs={}),n.attrs[s]=o}}),e.style&&(n.style=(n.style||"")+(typeof e.style=="string"?e.style:p(e.style,t,r))),e.bools){for(let a in e.bools)if(!a.startsWith("@")){let i=e.bools[a],s=typeof i=="string"?i:p(i,t,r);s&&(n.attrs||(n.attrs={}),n.attrs[a]=s)}}if(e.attrs){for(let a in e.attrs)if(!a.startsWith("@")){let i=e.attrs[a];n.attrs||(n.attrs={}),n.attrs[a]=typeof i=="string"?i:p(i,t,r)}}if(e.class&&e.class.forEach(a=>n.class=(n.class||[]).concat(Array.isArray(a)?a:p(a,t,r))),e.part&&e.part.forEach(a=>n.part=(n.part||[]).concat(Array.isArray(a)?a:p(a,t,r))),e.on){n.on||(n.on={});for(let a in e.on)n.on[a]=(n.on[a]||[]).concat(e.on[a].map(i=>p(i,t,r)))}}function it(e,t,r=e.length-1,n=t.length-1){let[a,i]=F(e,"loop",r),[s,o]=F(t,"loop",n);return!a&&!s?!0:!a||!s?!1:a.index===s.index&&a.key===s.key&&a.value===s.value&&it(e,t,i-1,o-1)}function _e(e){return e==null?[]:Array.isArray(e)?e:[e]}function St(e,t){switch(e){case"void":return;case"typeof":return typeof t;case"+":return+t;case"-":return-t;case"~":return~t;case"!":return!t;default:throw Error(e+" does not exist")}}function nt(e,t){switch(e){case"&&":return!!t;case"||":return!t;case"??":return t==null;default:return!0}}function at(e,t,r){switch(e){case"+":return t+r;case"-":return t-r;case"/":return t/r;case"*":return t*r;case"%":return t%r;case"**":return t**r;case"in":return t in r;case"instanceof":return t instanceof r;case"<":return t<r;case">":return t>r;case"<=":return t<=r;case">=":return t>=r;case"==":return t==r;case"!=":return t!=r;case"===":return t===r;case"!==":return t!==r;case"<<":return t<<r;case">>":return t>>r;case">>>":return t>>>r;case"&":return t&r;case"|":return t|r;case"^":return t^r;case"&&":return t&&r;case"||":return t||r;case"??":return t??r;default:throw Error(e+" does not exist")}}function Oe(e){if(typeof e=="string")return e.split(/\s+/);if(typeof e=="object"){if(Array.isArray(e))return e;if(e)return Object.keys(e).filter(t=>e[t])}return[]}function Lt(e){return e.children?st(e.children):""}function st(e){return e.filter(t=>typeof t!="number").map(t=>typeof t=="string"?t:_t(t)).join("")}function _t(e){let t=e.is?` is="${e.is}"`:"",r=e.class?` class="${e.class.join(" ")}"`:"",n=e.part?` part="${e.part.join(" ")}"`:"",a=e.style?` style="${e.style}"`:"",i=e.attrs?Object.entries(e.attrs).map(o=>` ${o[0]}="${o[1]}"`).join(""):"",s=e.children?st(e.children):"";return"<"+e.tag+t+r+n+a+i+`>${de(e.tag)?"":`${s}</${e.tag}>`}`}function Ot(e,t,r){let[,n]=F(e,t);if(n>0&&t in e[n])e[n][t]=r;else throw Error('Variable "'+t+'" is missing.')}function Pt(e,t){return{template:typeof e=="string"?E(e):e,restack:t||(r=>r)}}var X=Symbol.for("Jito Special");function y(e){return typeof e=="object"&&e!==null&&(e.template||e.patcher)&&e.main&&e.options}function Te(e){return typeof e=="object"&&e!==null&&"default"in e&&e[Symbol.toStringTag]==="Module"}function ye(e,t,r={children:[]}){return e.children&&(e.children=e.children.filter(n=>{if(typeof n=="object"){if(t(n))return r.children.push(n),!1;"tag"in n&&ye(n,t,r)}return!0}),e.children.length||delete e.children),r.children.length?r:{}}function ke(...e){let t={children:[]};return e.forEach(r=>{r&&r.children&&(t.children=t.children.concat(r.children))}),t.children.length?t:{}}var ot=Object.freeze({alert,console,Object:Object.freeze({entries:Object.entries,fromEntries:Object.fromEntries,hasOwn:Object.hasOwn,is:Object.is,keys:Object.keys,values:Object.values}),Number,Math,Date,Array,JSON,String,isNaN,isFinite,location,history,navigator,setTimeout,structuredClone:typeof structuredClone<"u"?structuredClone:void 0});var v=class{constructor(t,r,n){this._attrs={};this._refs={};this._requirePatch=!1;let a=n.el;this._component=t,this._template=t.template,this._patcher=t.patcher,this._host=r,this._tree=n,this._updater=new Pe(n),this._watcher=new Set,this.patch=this.patch.bind(this),this.watch=this.watch.bind(this),this.take=this.take.bind(this),this.dispatch=this.dispatch.bind(this),this._cache={[X]:[r,a]},this._component.options.mode==="closed"&&a.addEventListener(L.patch,s=>s.stopPropagation()),r.addEventListener(L.destroy,()=>{this.patch({type:"tree"}),this._watcher.forEach(s=>D(...s)),J(this._stack,this.patch)});let i=typeof this._component.main=="function"?this._component.main(this):this._component.main;this._ready=(async()=>{let s=await i,o=s?Array.isArray(s)?s:[s]:[];this._stack=[ot,{host:r,root:a},A(this._attrs),...o],be(this._stack,this.patch),this.patch(),o.forEach(l=>{if(typeof l=="object"&&l!==null){for(let c in l)if((typeof l[c]=="function"||l[c]instanceof Element)&&isNaN(c)&&!(c in this._host)){let x=typeof l[c]=="function"?l[c].bind(this):l[c];Object.defineProperty(this._host,c,{get(){return x}})}}})})()}setAttr(t,r){switch(t){case"is":case"class":case"part":case"style":return;default:if(this._attrs[t]!==r){if(t in this._refs){let a=this._refs[t][0];if(W(r)&&r.record===a.record)return;D(this._attrs,t,this._refs[t][1]),D(a.record,a.key,this._refs[t][2]),delete this._refs[t]}if(W(r)){let a=s=>{r.record[r.key]=s},i=s=>{this._attrs[t]=s};this._refs[t]=[r,a,i],A(this._attrs,t,a),A(r.record,r.key,i),re(this._attrs,t,r.record[r.key])}else re(this._attrs,t,r)}}}get component(){return this._component}get host(){return this._host}get root(){return this._tree.el}get attrs(){return this._attrs}get ready(){return()=>this._ready}patch(t){t&&(typeof t=="function"?(this._patcher=t,this._template=void 0):(this._patcher=void 0,this._template=typeof t=="string"?E(t):t)),this._requirePatch||(this._requirePatch=!0,setTimeout(()=>{if(this._requirePatch=!1,this._stack){let r=this._patcher?this._patcher(this._stack):this._template?p(this._template,this._stack,this._cache):this._tree&&this._component.template?p(this._component.template,this._stack,this._cache):void 0;r&&this._updater.patch(r)}}))}dispatch(t,r=null){this._host.dispatchEvent(new CustomEvent(t,{detail:typeof structuredClone<"u"?structuredClone(r):JSON.parse(JSON.stringify(r))}))}watch(t,r,n,a){return this._watcher.add([t,r,n]),A(t,r,n,a)}async take(t={}){let r=Object.entries(t).filter(n=>typeof n[1]=="object"&&n[1]!==null&&!("default"in n[1])||typeof n[1]=="boolean"&&n[1]).map(n=>n[0]);return Object.entries(t).filter(n=>typeof n[1]=="object"&&n[1]!==null&&"default"in n[1]).forEach(n=>{n[0]in this._attrs||(this._attrs[n[0]]=n[1].default)}),await xe(this._attrs,r),this._attrs}toJSON(){return{component:this._component,attrs:this._attrs,tree:this._tree}}};function jt(e){return"tag"in e&&(e.tag==="style"||e.tag==="link")}function lt(e){return e.tag==="link"&&(e.attrs&&e.attrs.href)!==""&&(e.attrs&&e.attrs.rel).toLocaleLowerCase()==="stylesheet"}var Pe=class{constructor(t){this.tree=t;this._waitUrls=new Set;this.loaded=t=>{this.removeWaitUrl(t.target.getAttribute("href"))}}patch(t){let r=ye(t,jt),n=t,a=this.header&&this.header.children&&this.header.children.filter(lt)||[],i=r.children&&r.children.filter(lt)||[],s=i.filter(l=>a.every(c=>(c.attrs&&c.attrs.href)!==(l.attrs&&l.attrs.href))),o=a.filter(l=>i.every(c=>(c.attrs&&c.attrs.href)!==(l.attrs&&l.attrs.href)));i.forEach(l=>{l.on||(l.on={}),l.on.load||(l.on.load=[]),l.on.load.includes(this.loaded)||l.on.load.push(this.loaded),l.on.error||(l.on.error=[]),l.on.error.includes(this.loaded)||l.on.error.push(this.loaded)}),s.forEach(l=>{this.addWaitUrl(l.attrs&&l.attrs.href),l.new=!0}),o.forEach(l=>this.removeWaitUrl(l.attrs&&l.attrs.href)),o.length?K(this.tree,ke(this.header,r,this.body),!1):K(this.tree,ke(r,this.body),!1),s.forEach(l=>l.new=!1),this.header=r,this.update=()=>{K(this.tree,ke(this.header,n)),ye(n,l=>(delete l.new,!1)),this.body=n}}set update(t){this._update=t,this._executeUpdate()}addWaitUrl(t){this._waitUrls.add(t)}removeWaitUrl(t){this._waitUrls.delete(t),this._executeUpdate()}_executeUpdate(){!this._waitUrls.size&&this._update&&(this._update(),this._update=void 0)}};var C="jito-element",k=class extends HTMLElement{constructor(){super()}setAttr(r,n){this._entity&&this._entity.setAttr(r,n)}static getComponent(){}loadAttrs(){this.hasAttributes()&&this.getAttributeNames().forEach(r=>{this.setAttr(r,this.getAttribute(r))})}ready(){return this._entity?this._entity.ready():new Promise(r=>{this._run=r})}_setEntity(r){this._entity=r,this._run&&this._entity.ready().then(this._run)}get entity(){return this._entity}get attributes(){return Vt(super.attributes,this.setAttr)}setAttribute(r,n){this.setAttr(r,n),super.setAttribute(r,n)}getAttributeNode(r){let n=super.getAttributeNode(r);return n&&pt(n,this.setAttr)}removeAttribute(r){return this.setAttr(r,void 0),super.removeAttribute(r)}removeAttributeNode(r){return this.setAttr(r.name,void 0),super.removeAttributeNode(r)}toJSON(){return{entity:this._entity}}},je=class extends k{constructor(){super()}setAttr(t,r){if(t==="component")switch(typeof r){case"string":{let n=customElements.get(r);if(n&&k.isPrototypeOf(n)){let a=n.getComponent();if(a){let i=_(this.attachShadow(a.options));this._setEntity(new v(a,this,i))}}else throw Error(r+" is not a component.");break}case"object":if(y(r)){let n=_(this.attachShadow(r.options));this._setEntity(new v(r,this,n))}else if(r!==null)throw Error("The object is not a component.");break}super.setAttr(t,r)}};customElements.get(C)||customElements.define(C,je);function pt(e,t){return new Proxy(e,{set(r,n,a){if(t(n,a),n==="value")return r.value=a}})}function Vt(e,t){return new Proxy(e,{get:function(r,n){return n==="length"?r[n]:pt(r[n],t)}})}async function Ft(e,t){let r;if(typeof e=="string")r=document.createElement(e);else{r=document.createElement(C);let n=await Promise.resolve(e),a=Te(n)&&y(n.default)?n.default:n;r.setAttribute("component",a)}if(t)for(let n in t)r.setAttribute(n,t[n]);if(typeof e=="string"){let n=customElements.get(e);n!==void 0&&Object.prototype.isPrototypeOf.call(k,n)&&await r.ready()}else await r.ready();return r}var ct={match(e,t,r){if(e.type==="custom"){if(e.tag===C)return!0;let n=e,a=n.tag.split("."),i=a.slice(1).reduce((s,o)=>s[o],T(t,a[0]));if(typeof i=="object"&&i!==null&&(y(i)||Te(i)&&y(i.default)))return!0;{let s=customElements.get(n.tag);return s!==void 0&&Object.prototype.isPrototypeOf.call(k,s)}}return!1},exec(e,t,r){let n=e,a={tag:C},i;if(n.tag!==C){let s=n.tag.split(".");i=s.slice(1).reduce((o,l)=>o[l],T(t,s[0])),i?(a.attrs||(a.attrs={}),a.attrs.component=i):a.tag=n.tag}return ge(n,t,r,a),w(n,t,r,a),n.tag===C&&(i=a.attrs&&a.attrs.component,a.attrs||(a.attrs={}),a.attrs.component=i),typeof i=="object"&&i!==null&&"default"in i&&i[Symbol.toStringTag]==="Module"&&y(i.default)&&(i=i.default,a.attrs||(a.attrs={}),a.attrs.component=i),n.cache!==i&&(a.new=!0),n.cache=i,a}},ut={match(e,t,r){if(e.type==="custom"){let n=e.tag.split("."),a=n.slice(1).reduce((i,s)=>i[s],T(t,n[0]));return typeof a=="object"&&a!==null&&a instanceof k}return!1},exec(e,t,r){let n=e,a=n.tag.split("."),i=a.slice(1).reduce((o,l)=>o[l],T(t,a[0])),s={el:i};return ge(n,t,r,s),w(n,t,r,s),i instanceof Element&&n.attrs&&"@override"in n.attrs&&(s.override=!0),n.children&&n.children.length?s.children=H(n,t,r):s.invalid={children:!0},s}},mt={match(e,t,r){if(e.type==="custom"&&X in r&&!N(e.tag)){let n=T(t,e.tag);return r[X].some(a=>a===n)}return!1},exec(e,t,r){let a={el:T(t,e.tag)||ShadowRoot,override:!0,invalid:{attrs:!0,children:!0}};return w(e,t,r,a),a}};p.plugin(ct);p.plugin(mt);p.plugin(ut);function Y(e,t=[]){let r={main:typeof t=="function"||Array.isArray(t)?t:[t],options:{mode:"open"}};return typeof e=="function"?r.patcher=e:r.template=typeof e=="string"?E(e):e,Re(r)}function Mt(e,t,r=[]){let n=y(t)?t:Y(t,r);if(n.options.localeOnly)throw Error("This componet is local only.");customElements.define(e,class extends k{constructor(){super();let a=_(this.attachShadow(n.options));this._setEntity(new v(n,this,a)),this.innerHTML&&Ve(E(this.innerHTML)).forEach(([s,o])=>{this.entity.setAttr(s,o)}),this.loadAttrs()}static getComponent(){return n}})}function Ve(e){let t=[],r=[];return(e.children||[]).map(n=>{if(typeof n!="string"){let a=n;if(a.attrs){if(a.attrs["@as"])return r.push([a.attrs["@as"],a]),[];if(a.attrs.slot)return[p(n)]}}return t.push(n),[]}).reduce((n,a)=>(n.push(...a),n),[]),t.length&&r.push(["content",{type:"group",children:t}]),r}function Ht(e,t,r=[]){let n=typeof e=="string"?document.querySelector(e):e,a=y(t)?t:Y(t,r);if(a.options.localeOnly)throw Error("This componet is local only.");let i=_(n.attachShadow(a.options)),s=new v(a,n,i);n.innerHTML&&Ve(E(n.innerHTML)).forEach(([l,c])=>{s.setAttr(l,c)}),n.hasAttributes()&&n.getAttributeNames().forEach(o=>{s.setAttr(o,n.getAttribute(o))})}function It(e,t={}){return e.options=Object.freeze(Object.assign({mode:"closed"},t)),Object.freeze(e)}export{k as ComponentElement,v as Entity,U as Loop,Ot as assign,re as change,Y as compact,Mt as define,V as destroy,Ft as elementize,p as evaluate,L as eventTypes,d as expression,_ as load,Re as lock,Ht as mount,E as parse,K as patch,T as pickup,be as reach,xe as receive,Lt as render,It as seal,Pt as snip,dt as unlock,J as unreach,D as unwatch,A as watch};
