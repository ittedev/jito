<!DOCTYPE html>
<meta charset="UTF-8">
<title>virtual_dom/load.test.js</title>
<link rel="stylesheet" href="https://unpkg.com/mocha/mocha.css" />
<div id="mocha"></div>
<script src="https://unpkg.com/chai/chai.js"></script>
<script>
var i = 0
var equal = (v, p) => chai.expect(v === undefined ? v : JSON.parse(JSON.stringify(v))).deep.equal(p)
var sleep = t => new Promise(r => setTimeout(r, t || 0))
</script>
<script src="https://unpkg.com/mocha/mocha.js"></script>
<script type="module">
import {
  MemoryHistory,
  walk,
} from '../router.js'

mocha.setup('bdd')

describe('Router', function() {
  describe('MemoryHistory', function() {
    describe('new:', function() {
      it('pushState state', () => {
        let history = new MemoryHistory()
        equal(history.state, null)
        equal(history.length, 1)
      })
    })

    describe('pushState():', function() {
      it('pushState state', () => {
        let history = new MemoryHistory()
        history.pushState(100, '', 'abc')
        equal(history.state, 100)
        equal(history.length, 2)
      })
      it('pushState states', () => {
        let history = new MemoryHistory()
        history.pushState(100, '', 'abc')
        history.pushState(200, '', 'abc')
        equal(history.state, 200)
        equal(history.length, 3)
      })
    })

    describe('replaceState():', function() {
      it('replaceState state', () => {
        let history = new MemoryHistory()
        history.replaceState(100, '', 'abc')
        equal(history.state, 100)
        equal(history.length, 1)
      })
      it('replaceState states', () => {
        let history = new MemoryHistory()
        history.replaceState(100, '', 'abc')
        history.replaceState(200, '', 'abc')
        equal(history.state, 200)
        equal(history.length, 1)
      })
    })

    describe('go():', function() {
      it('no back', async () => {
        let history = new MemoryHistory()
        history.back()
        await sleep(1)
        equal(history.state, null)
        equal(history.length, 1)
      })

      it('back', async () => {
        let history = new MemoryHistory()
        history.pushState(100, '', 'abc')
        history.back()
        equal(history.state, 100)
        equal(history.length, 2)
        await sleep(1)
        equal(history.state, null)
        equal(history.length, 2)
      })

      it('no forward', async () => {
        let history = new MemoryHistory()
        history.forward()
        await sleep(1)
        equal(history.state, null)
        equal(history.length, 1)
      })

      it('forward', async () => {
        let history = new MemoryHistory()
        history.pushState(100, '', 'abc')
        history.back()
        await sleep(1)
        history.forward()
        equal(history.state, null)
        equal(history.length, 2)
        await sleep(1)
        equal(history.state, 100)
        equal(history.length, 2)
      })
      it('go -2', async () => {
        let history = new MemoryHistory()
        history.pushState(100, '', 'abc')
        history.pushState(200, '', 'abcd')
        history.go(-2)
        equal(history.state, 200)
        equal(history.length, 3)
        await sleep(1)
        equal(history.state, null)
        equal(history.length, 3)
      })
      it('go 2', async () => {
        let history = new MemoryHistory()
        history.pushState(100, '', 'abc')
        history.pushState(200, '', 'abcd')
        history.go(-2)
        await sleep(1)
        history.go(2)
        equal(history.state, null)
        equal(history.length, 3)
        await sleep(1)
        equal(history.state, 200)
        equal(history.length, 3)
      })
    })
  })
})

mocha.run()
</script>